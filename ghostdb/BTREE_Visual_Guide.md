# B+ Tree Visual Guide - Complete Demonstration

## B+ Tree Basics

**Order = 3** (max 3 keys per node, max 4 children)

### Key Rules:
1. All data is stored in LEAF nodes only
2. Internal nodes only store keys for navigation
3. Leaf nodes are linked together (for range scans)
4. Keys are always sorted
5. Tree is always balanced

---

## Example 1: Empty Tree â†’ Insert First Key

### Insert: 50

```
Before:
(empty)

After:
â”Œâ”€â”€â”€â”€â”€â”
â”‚ 50  â”‚  â† Root (also a leaf)
â””â”€â”€â”€â”€â”€â”˜
```

---

## Example 2: Insert More Keys (No Split Yet)

### Insert: 50, 30, 70

```
Step 1: Insert 50
â”Œâ”€â”€â”€â”€â”€â”
â”‚ 50  â”‚
â””â”€â”€â”€â”€â”€â”˜

Step 2: Insert 30 (goes before 50)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 30 | 50  â”‚  â† Binary search finds position
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: Insert 70 (goes after 50)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 30 | 50 | 70   â”‚  â† Still fits (max 3 keys)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Example 3: Node Split (Overflow!)

### Insert: 50, 30, 70, 20

```
Before insert 20:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 30 | 50 | 70   â”‚  â† 3 keys (at capacity)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Insert 20:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 | 30 | 50 | 70   â”‚  â† 4 keys! OVERFLOW!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Split at middle (index 2):
Left half: [20, 30]
Right half: [50, 70]
Promote: 50 (middle key goes up)

After split:
         â”Œâ”€â”€â”€â”€â”€â”
         â”‚ 50  â”‚  â† Root (internal node)
         â””â”€â”€â”¬â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 | 30  â”‚â†’ â”‚ 50 | 70  â”‚  â† Leaves (linked with â†’)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Example 4: Building a Larger Tree

### Insert: 50, 30, 70, 20, 40, 60, 80

```
Step-by-step:

1. Insert 50, 30, 70, 20 (from Example 3):
         â”Œâ”€â”€â”€â”€â”€â”
         â”‚ 50  â”‚
         â””â”€â”€â”¬â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 | 30  â”‚â†’ â”‚ 50 | 70  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Insert 40 (goes in left leaf):
         â”Œâ”€â”€â”€â”€â”€â”
         â”‚ 50  â”‚
         â””â”€â”€â”¬â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 | 30 | 40   â”‚â†’ â”‚ 50 | 70  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Insert 60 (goes in right leaf):
         â”Œâ”€â”€â”€â”€â”€â”
         â”‚ 50  â”‚
         â””â”€â”€â”¬â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 | 30 | 40   â”‚â†’ â”‚ 50 | 60 | 70   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Insert 80 (right leaf overflows!):
Right leaf before: [50, 60, 70]
Insert 80: [50, 60, 70, 80] â† OVERFLOW!

Split right leaf:
Left: [50, 60]
Right: [70, 80]
Promote: 70

Final tree:
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ 50 | 70  â”‚  â† Root (2 keys now)
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“        â†“        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 | 30 | 40   â”‚â†’ â”‚ 50 | 60  â”‚â†’ â”‚ 70 | 80  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Example 5: Three-Level Tree

### Insert: 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120

```
Final structure:

                    â”Œâ”€â”€â”€â”€â”€â”
                    â”‚ 60  â”‚  â† Root (Level 2)
                    â””â”€â”€â”¬â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 30 | 50  â”‚      â”‚ 90 | 110 â”‚  â† Internal nodes (Level 1)
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
      â†“       â†“       â†“   â†“     â†“      â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”
   â”‚10|20 â”‚â”‚30|40 â”‚â”‚50|60 â”‚â”‚70|80 â”‚â”‚90|100â”‚â”‚110|120â”‚  â† Leaves (Level 0)
   â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜
      â†’       â†’       â†’       â†’       â†’       â†’
```

**Key Points:**
- All data (10, 20, 30...) is in LEAVES only
- Internal nodes (30, 50, 60, 90, 110) are just guides
- Leaves are linked left-to-right with â†’
- Tree height = 3 (root, internal, leaves)

---

## Example 6: Search Operation

### Search for key = 75

```
Tree:
                    â”Œâ”€â”€â”€â”€â”€â”
                    â”‚ 60  â”‚  â† Start here
                    â””â”€â”€â”¬â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 30 | 50  â”‚      â”‚ 90 | 110 â”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
      â†“       â†“       â†“   â†“     â†“      â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”
   â”‚10|20 â”‚â”‚30|40 â”‚â”‚50|60 â”‚â”‚70|80 â”‚â”‚90|100â”‚â”‚110|120â”‚
   â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜

Step 1: At root (60)
  75 > 60? YES â†’ Go right

Step 2: At internal node (90, 110)
  75 < 90? YES â†’ Go to first child

Step 3: At leaf (70, 80)
  Binary search: [70, 80]
  Found 75? NO (between 70 and 80)
  Return: NOT FOUND

Total comparisons: 3 (logâ‚ƒ 12 â‰ˆ 2.3)
```

---

## Example 7: Range Query

### Find all keys between 35 and 85

```
Tree:
                    â”Œâ”€â”€â”€â”€â”€â”
                    â”‚ 60  â”‚
                    â””â”€â”€â”¬â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 30 | 50  â”‚      â”‚ 90 | 110 â”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
      â†“       â†“       â†“   â†“     â†“      â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”
   â”‚10|20 â”‚â”‚30|40 â”‚â”‚50|60 â”‚â”‚70|80 â”‚â”‚90|100â”‚â”‚110|120â”‚
   â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜
      â†’       â†’       â†’       â†’       â†’       â†’

Step 1: Find start (35)
  Navigate to leaf containing 35
  Land at: [30, 40]
  Start from: 40 (first key â‰¥ 35)

Step 2: Scan right using links
  [30, 40] â†’ collect 40 âœ“
  â†’ [50, 60] â†’ collect 50, 60 âœ“
  â†’ [70, 80] â†’ collect 70, 80 âœ“
  â†’ [90, 100] â†’ 90 > 85, STOP

Result: [40, 50, 60, 70, 80]
Cost: O(log n + k) = O(log 12 + 5) â‰ˆ 7 operations
```

---

## Example 8: Insertion with Root Split

### Insert into full tree: 10, 20, 30, 40, 50, 60, 70, 80, 90, then 25

```
Before insert 25:
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ 40 | 70  â”‚  â† Root is full (3 keys)
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“        â†“        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10 | 20  â”‚â”‚ 40 | 50  â”‚â”‚ 70 | 80  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Insert 25 into first leaf:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10 | 20 | 25   â”‚  â† Still fits
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

But wait, let's say we insert 15 too:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10 | 15 | 20 | 25   â”‚  â† OVERFLOW!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Split leaf:
Left: [10, 15]
Right: [20, 25]
Promote: 20

Try to insert 20 into root:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 | 40 | 70 | ... â”‚  â† Root overflows!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Split root (tree grows taller!):
         â”Œâ”€â”€â”€â”€â”€â”
         â”‚ 40  â”‚  â† New root (Level 2)
         â””â”€â”€â”¬â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20 | 30  â”‚  â”‚ 70 | 80  â”‚  â† Old root split (Level 1)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      ...           ...

Tree height increased from 2 to 3!
```

---

## Example 9: Real-World Scenario - User Database

### Storing usernames: alice, bob, charlie, david, eve, frank

```
Order = 3 (max 3 keys per node)

Step 1: Insert alice, bob, charlie
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ alice | bob | charlie   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: Insert david (overflow!)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ alice | bob | charlie | david    â”‚  â† 4 keys!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Split:
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ charlie   â”‚  â† Root
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ alice | bob  â”‚â†’ â”‚ charlie | david â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: Insert eve
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ charlie   â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ alice | bob  â”‚â†’ â”‚ charlie | david | eve  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: Insert frank (right leaf overflows!)
Right leaf: [charlie, david, eve, frank] â† 4 keys!

Split:
Left: [charlie, david]
Right: [eve, frank]
Promote: eve

Final tree:
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ charlie | eve    â”‚  â† Root
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ alice | bob  â”‚â”‚charlie|david â”‚â”‚ eve | frank  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†’               â†’               â†’
```

---

## Example 10: Range Query on Usernames

### Find all users from "bob" to "eve"

```
Tree:
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ charlie | eve    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ alice | bob  â”‚â”‚charlie|david â”‚â”‚ eve | frank  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†’               â†’               â†’

Step 1: Find "bob"
  Navigate to first leaf
  Found: bob âœ“

Step 2: Scan right
  [alice, bob] â†’ collect bob âœ“
  â†’ [charlie, david] â†’ collect charlie, david âœ“
  â†’ [eve, frank] â†’ collect eve âœ“, stop at frank

Result: [bob, charlie, david, eve]
Cost: O(log n + k) = O(2 + 4) = 6 operations

Compare to hash table:
  Must scan ALL entries: O(n) = 6 operations
  No sorted order, must sort: O(n log n) = 15 operations
```

---

## Example 11: Deletion (Simple Case)

### Delete "david" from tree

```
Before:
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ charlie | eve    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ alice | bob  â”‚â”‚charlie|david â”‚â”‚ eve | frank  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After deleting david:
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ charlie | eve    â”‚  â† No change (still valid)
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ alice | bob  â”‚â”‚ charlie      â”‚â”‚ eve | frank  â”‚  â† david removed
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Middle leaf has 1 key (minimum is 1 for order 3)
Still valid! âœ“
```

---

## Example 12: Why Leaf Linking Matters

### Compare: With vs Without Leaf Links

```
WITHOUT leaf links (regular B-tree):
Range query [30-80]:

                    â”Œâ”€â”€â”€â”€â”€â”
                    â”‚ 60  â”‚
                    â””â”€â”€â”¬â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 30 | 50  â”‚      â”‚ 90 | 110 â”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
      â†“       â†“       â†“   â†“     â†“      â†“
   [10,20] [30,40] [50,60] [70,80] [90,100] [110,120]

Must traverse tree for EACH leaf:
1. Find 30 â†’ [30,40] (log n)
2. Find 40 â†’ [30,40] (log n)
3. Find 50 â†’ [50,60] (log n)
4. Find 60 â†’ [50,60] (log n)
5. Find 70 â†’ [70,80] (log n)
6. Find 80 â†’ [70,80] (log n)

Total: 6 * log n operations âŒ


WITH leaf links (B+ tree):
Range query [30-80]:

   [10,20] â†’ [30,40] â†’ [50,60] â†’ [70,80] â†’ [90,100] â†’ [110,120]
                â†‘         â†‘         â†‘
              Start     Follow    Follow

1. Find 30 â†’ [30,40] (log n)
2. Follow link â†’ [50,60] (1)
3. Follow link â†’ [70,80] (1)

Total: log n + 2 operations âœ“

Speedup: 6 * log n vs log n + 2
For n=1000: 60 vs 12 operations (5x faster!)
```

---

## Example 13: Concurrent Operations with Locking

### Two threads inserting simultaneously

```
Tree:
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ 50 | 80  â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“        â†“        â†“
   [10,20] [50,60] [80,90]
      ğŸ”“      ğŸ”“      ğŸ”“  â† All unlocked

Thread 1: Insert 25 (goes to first leaf)
Thread 2: Insert 85 (goes to third leaf)

Step 1: Both navigate to their leaves
   [10,20] [50,60] [80,90]
      â†‘              â†‘
   Thread 1      Thread 2

Step 2: Acquire locks
   [10,20] [50,60] [80,90]
      ğŸ”’      ğŸ”“      ğŸ”’  â† Different nodes, both succeed!

Step 3: Insert in parallel
   [10,20,25] [50,60] [80,85,90]
      ğŸ”’         ğŸ”“        ğŸ”’

Step 4: Release locks
   [10,20,25] [50,60] [80,85,90]
      ğŸ”“         ğŸ”“        ğŸ”“

Both operations completed in parallel! âœ“

If they tried to insert into SAME leaf:
Thread 1: Acquires lock ğŸ”’
Thread 2: Waits in queue â³
Thread 1: Releases lock ğŸ”“
Thread 2: Acquires lock ğŸ”’
```

---

## Summary: B+ Tree Advantages

### 1. All Data in Leaves
```
Internal: [30, 60, 90]  â† Just guides
Leaves:   [10,20] [30,40,50] [60,70,80] [90,100]  â† Actual data
```

### 2. Sorted Order
```
Leaves: [10,20] â†’ [30,40,50] â†’ [60,70,80] â†’ [90,100]
Always sorted, no need to sort results!
```

### 3. Fast Range Queries
```
Find [35-75]:
1. Navigate to 35: O(log n)
2. Scan right: O(k)
Total: O(log n + k)
```

### 4. Balanced Tree
```
All leaves at same depth:
Height = log_m(n) where m = order
For 1000 keys, order 100: height = 2
```

### 5. Parallel Operations
```
Different leaves = Different locks
Multiple threads can insert/delete simultaneously
```

### 6. Cache-Friendly
```
Sequential leaf scan:
[10,20] â†’ [30,40] â†’ [50,60]
CPU cache loves this! High hit rate
```

---

## Comparison: Hash vs B+ Tree

```
Hash Table:
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ 10 â”‚ 50 â”‚ 30 â”‚ 70 â”‚ 20 â”‚  â† Unordered
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

Lookup: O(1) âœ“
Range query: O(n) âŒ
Sorted scan: O(n log n) âŒ


B+ Tree:
   [10,20] â†’ [30,40] â†’ [50,60] â†’ [70,80]  â† Ordered

Lookup: O(log n) âœ“
Range query: O(log n + k) âœ“
Sorted scan: O(n) âœ“


GhostDB: Use BOTH!
- Hash for equality: username = "alice"
- B+ Tree for ranges: timestamp > 1234567890
```

---

## Real-World Example: Authentication Logs

```
Collection: auth_logs
Fields: userId, timestamp, success

B+ Tree on timestamp:

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ 1000000000 â”‚  â† Root
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 100000000  â”‚            â”‚ 5000000000 â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“                 â†“       â†“                 â†“
[ts:100, user:alice] [ts:500, user:bob] [ts:1000, user:charlie] [ts:5000, user:david]
[success:true]       [success:false]    [success:true]          [success:true]
      â†’                     â†’                  â†’                      â†’

Query: "Get all failed auth attempts in last hour"
WHERE timestamp > (now - 3600) AND success = false

1. Navigate to timestamp (now - 3600): O(log n)
2. Scan right until now: O(k)
3. Filter success = false: O(k)

Total: O(log n + k) â† Super fast!
```

This is why B+ Tree is perfect for GhostDB! ğŸš€
